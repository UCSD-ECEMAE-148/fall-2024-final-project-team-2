(self.webpackChunkUCSD_ECEMAE_148=self.webpackChunkUCSD_ECEMAE_148||[]).push([[720],{8760:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/gps.fee095b.500.png 500w,"+n.p+"assets/ideal-img/gps.dad0029.1000.png 1000w,"+n.p+"assets/ideal-img/gps.64340c0.1500.png 1500w,"+n.p+"assets/ideal-img/gps.d0b59df.2000.png 2000w",images:[{path:n.p+"assets/ideal-img/gps.fee095b.500.png",width:500,height:165},{path:n.p+"assets/ideal-img/gps.dad0029.1000.png",width:1e3,height:329},{path:n.p+"assets/ideal-img/gps.64340c0.1500.png",width:1500,height:494},{path:n.p+"assets/ideal-img/gps.d0b59df.2000.png",width:2e3,height:659}],src:n.p+"assets/ideal-img/gps.fee095b.500.png",toString:function(){return n.p+"assets/ideal-img/gps.fee095b.500.png"},placeholder:void 0,width:500,height:165},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAOUlEQVR4nE2MCQoAMQwC+/83x5nFlMIigheeEJNHnMSZEVj/utPgUlHDHVdTNIf/sNUN+7B6vfv4AZj9dxjRnX5SAAAAAElFTkSuQmCC"}},9824:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>u,default:()=>f,frontMatter:()=>c,metadata:()=>d,toc:()=>p});var a=n(7624),r=n(4552),o=n(6936),s=n(184),i=n(8760),l=n.n(i);const c={id:"gps",title:"GPS with PointOneNav and DonkeyCar",tags:["GPS","PointOneNav","DonkeyCar","Controls"],sidebar_position:4,last_update:{date:"12/4/2024",author:"Kevin Shin"}},u="GPS with PointOneNav and DonkeyCar",d={id:"gps/gps",title:"GPS with PointOneNav and DonkeyCar",description:"We did an assignment with the Jetson Nano, using GPS and PID tuning to autonomously control the car, given a recorded path. This assignment took by far the longest, taking us two weeks and can be attributed to a few core issues.",source:"@site/docs/gps/index.mdx",sourceDirName:"gps",slug:"/gps/",permalink:"/fall-2024-final-project-team-2/docs/gps/",draft:!1,unlisted:!1,tags:[{label:"GPS",permalink:"/fall-2024-final-project-team-2/docs/tags/gps"},{label:"PointOneNav",permalink:"/fall-2024-final-project-team-2/docs/tags/point-one-nav"},{label:"DonkeyCar",permalink:"/fall-2024-final-project-team-2/docs/tags/donkey-car"},{label:"Controls",permalink:"/fall-2024-final-project-team-2/docs/tags/controls"}],version:"current",lastUpdatedBy:"Kevin Shin",lastUpdatedAt:1733299200,formattedLastUpdatedAt:"Dec 4, 2024",sidebarPosition:4,frontMatter:{id:"gps",title:"GPS with PointOneNav and DonkeyCar",tags:["GPS","PointOneNav","DonkeyCar","Controls"],sidebar_position:4,last_update:{date:"12/4/2024",author:"Kevin Shin"}},sidebar:"noteSidebar",previous:{title:"Deep Learning with DonkeyCar",permalink:"/fall-2024-final-project-team-2/docs/deep-learning/"},next:{title:"Lane Tracking with ROS2 and OpenCV2",permalink:"/fall-2024-final-project-team-2/docs/lane-tracking/"}},h={},p=[{value:"GPS Configuration",id:"gps-configuration",level:2},{value:"Running our car",id:"running-our-car",level:2},{value:"PID Tuning",id:"pid-tuning",level:2}];function g(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,r.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"gps-with-pointonenav-and-donkeycar",children:"GPS with PointOneNav and DonkeyCar"}),"\n",(0,a.jsx)(t.p,{children:"We did an assignment with the Jetson Nano, using GPS and PID tuning to autonomously control the car, given a recorded path. This assignment took by far the longest, taking us two weeks and can be attributed to a few core issues."}),"\n",(0,a.jsx)(t.p,{children:"The first issue was latency. We first started out with the PointOneNav GNSS, but we saw that there was a 5 second latency when communicating between the basestation and our jetson nano. We then swapped it out for a Ublox, which also gave the same latency error.\r\nWe returned back to PointOneNav and got our PID tuned such that our car was now autonomous."}),"\n",(0,a.jsx)(t.p,{children:"It was also on this assignment that we realized our shocks were causing our car to tilt heavily towards one side. This caused difficulty in finding our PID solution as the car naturally tilted towards one side."}),"\n",(0,a.jsx)(t.h2,{id:"gps-configuration",children:"GPS Configuration"}),"\n",(0,a.jsx)(t.p,{children:"Both GNSS uses the DonkeyCar framework, and nothing is different within the configuration of the DonkeyCar framework between them. The only difference is in setting up the boilerplate for communicating with DonkeyCar."}),"\n",(0,a.jsxs)(o.c,{children:[(0,a.jsxs)(s.c,{value:"PointOneNav",label:"PointOneNav",children:[(0,a.jsx)(t.p,{children:"On the Jetson Nano, we created a new user to the dialout group which has full access to serial ports. This is necessary as information flows in and out of the serial ports."}),(0,a.jsx)(t.p,{children:"We then installed proprietary software that bridged the PointOneNav hardware to the DonkeyCar framework. Unfortunately, since it is class software, we cannot share it.\r\nThe following commands can then be ran"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-pypy3-Linux-aarch64.sh .\r\nbash Mambaforge-pypy3-Linux-aarch64.sh\r\nsudo reboot\r\n\r\nmamba create --name py37 -c conda-forge python=3.7 pip\r\nmamba activate py37\r\npip3 install -e .    \r\npip install pyserial\r\npip install fusion_engine_client\r\npip install pynmea\r\npip install ntripstreams\r\npip install websockets\r\n\r\npython3 bin/config_tool.py reset factory\r\npython3 bin/config_tool.py apply uart2_message_rate nmea gga on\r\npython3 bin/config_tool.py save\r\n\r\npython3 bin/runner.py --device-id <polaris_username> --polaris <polaris_password> --device-port /dev/ttyUSB1\n"})}),(0,a.jsx)(t.p,{children:"Polaris is the basestation we're connecting to.  We set up a script file for the last line which starts a connection with the basestation with the 7 different credentials we were given. This allowed us to run one script file with an argument of which credential to use instead of having to manually enter the credentials."}),(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsx)(t.p,{children:"The PointOneNav requires this basetation to be running in a terminal. This means we need two terminals for this configuration."})})]}),(0,a.jsxs)(s.c,{value:"Ublox",label:"Ublox",children:[(0,a.jsx)(t.p,{children:"You don't need anything to run Ublox as DonkeyCar supports Ublox."}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)("img",{src:"https://media1.tenor.com/m/tCL3HGcaV4UAAAAd/raccoon-dance.gif",alt:"Raccoon Dancing"})})]})]}),"\n",(0,a.jsx)(t.h2,{id:"running-our-car",children:"Running our car"}),"\n",(0,a.jsx)(t.p,{children:"On another terminal, we sourced our virtual environment and created our GPS donkeycar folder."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"donkey createcar --path ./mycar --template path_follow\n"})}),"\n",(0,a.jsx)(t.p,{children:"The configuration file must have these changes in addition to the VESC configurations we set for DonkeyCar Simulator."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-py",children:"GPS_SERIAL = \u201c/dev/ttyUSB2\u201d # (USB1 if USB0 used above)\r\nGPS_SERIAL_BAUDRATE = 460800 \r\n# GPS_SERIAL = \u201c/dev/ttyUSB0\u201d # For Ublox\r\n# GPS_SERIAL_BAUDRATE = 38400 # For Ublox\r\nGPS_DEBUG = True\r\nHAVE_GPS = True\r\nGPS_NMEA_PATH = None\n"})}),"\n",(0,a.jsx)(t.p,{children:"The configurations below are customizable but are included to showcase the full setup. The settings below are the button mapout for our Logitech F710 controller."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-py",children:'SAVE_PATH_BTN = "R1"    \t  # button to save path\r\nLOAD_PATH_BTN = "X"         # button (re)load path\r\nRESET_ORIGIN_BTN = "B" \t    # button to press to move car back to origin\r\nERASE_PATH_BTN = "Y" \t      # button to erase path\r\nTOGGLE_RECORDING_BTN = "L1" # button to toggle recording mode\r\nINC_PID_D_BTN = None        # button to change PID \'D\' constant by PID_D_DELTA\r\nDEC_PID_D_BTN = None        # button to change PID \'D\' constant by -PID_D_DELTA\r\nINC_PID_P_BTN = "None"      # button to change PID \'P\' constant by PID_P_DELTA\r\nDEC_PID_P_BTN = "None"      # button to change PID \'P\' constant by -PID_P_DELTA\n'})}),"\n",(0,a.jsx)(t.p,{children:"We can then run the same command used to run the DonkeyCar simulator."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"python manage.py drive\n"})}),"\n",(0,a.jsx)(t.p,{children:"The recorded path will look like follows."}),"\n",(0,a.jsx)("img",{src:l().src,width:"960",height:"240",alt:"GPS Photo"}),"\n",(0,a.jsx)(t.h2,{id:"pid-tuning",children:"PID Tuning"}),"\n",(0,a.jsx)(t.p,{children:"This part took an entire two weeks alongside our hardware troubles. I can now see why people made better control algorithms. We won't give access to our PID tuning since this class will continue even after ours.\r\nIf PID tuning is proper, you should be able to autonomously drive a path like ours below. We doubled the playback speed to cut time."}),"\n",(0,a.jsx)("iframe",{width:"960",height:"520",src:"https://www.youtube.com/embed/9pHh7QOPzno",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0,title:"GPS Video"})]})}function f(e={}){const{wrapper:t}={...(0,r.M)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(g,{...e})}):g(e)}},184:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});n(1504);var a=n(5456);const r={tabItem:"tabItem__kUE"};var o=n(7624);function s(e){let{children:t,hidden:n,className:s}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,a.c)(r.tabItem,s),hidden:n,children:t})}},6936:(e,t,n)=>{"use strict";n.d(t,{c:()=>x});var a=n(1504),r=n(5456),o=n(7288),s=n(5592),i=n(3472),l=n(5068),c=n(604),u=n(6432);function d(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}(n);return function(e){const t=(0,c.w)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:n}=e;const r=(0,s.Uz)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._M)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=h(e),[s,l]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[c,d]=g({queryString:n,groupId:r}),[f,m]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,u.IN)(n);return[r,(0,a.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:r}),b=(()=>{const e=c??f;return p({value:e,tabValues:o})?e:null})();(0,i.c)((()=>{b&&l(b)}),[b]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),m(e)}),[d,m,o]),tabValues:o}}var m=n(9788);const b={tabList:"tabList_fbd4",tabItem:"tabItem_v5XY"};var w=n(7624);function y(e){let{className:t,block:n,selectedValue:a,selectValue:s,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.MV)(),u=e=>{const t=e.currentTarget,n=l.indexOf(t),r=i[n].value;r!==a&&(c(t),s(r))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,w.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.c)("tabs",{"tabs--block":n},t),children:i.map((e=>{let{value:t,label:n,attributes:o}=e;return(0,w.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>l.push(e),onKeyDown:d,onClick:u,...o,className:(0,r.c)("tabs__item",b.tabItem,o?.className,{"tabs__item--active":a===t}),children:n??t},t)}))})}function v(e){let{lazy:t,children:n,selectedValue:r}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,w.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function P(e){const t=f(e);return(0,w.jsxs)("div",{className:(0,r.c)("tabs-container",b.tabList),children:[(0,w.jsx)(y,{...e,...t}),(0,w.jsx)(v,{...e,...t})]})}function x(e){const t=(0,m.c)();return(0,w.jsx)(P,{...e,children:d(e.children)},String(t))}},4552:(e,t,n)=>{"use strict";n.d(t,{I:()=>i,M:()=>s});var a=n(1504);const r={},o=a.createContext(r);function s(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);